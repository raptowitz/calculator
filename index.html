<!DOCTYPE html>
<html>
    <head>
        <title>Calculator</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Audiowide&display=swap');

            body{
                display: flex;
                justify-content: center;
                background-color: #ECF5F8;
                font-family: 'Audiowide', cursive;
            }

            .calculator{
                margin-top: 15vh;
                padding: 20px;
                border-radius: 5px;
                background-color: #110934;

                display: grid;
                grid-template-columns: 70px 70px 70px 70px;
                grid-template-rows: 80px 70px 70px 70px 70px 70px;
                gap: 3px 3px;
                grid-template-areas:
                    "display display display display"
                }

            .display{
                background: #b9b9b9;
                padding: 25px 10px 0px 0px;
                margin-bottom: 5px;
                grid-area: 1/1/2/5;
                text-align: right;
                font-size: 40px;
            }

            #zero{
                grid-area: 6/1/7/3
            }

            .topButton{
                background-color: #347B98
            }

            .number{
                background-color: #8964ac
            }

            .operator{
                background-color: #FB9902
            }

            .operate{
                background-color: #FB9902
            }

            button{
                font-size: 14px;
                border: 0pt;
                border-radius: 2px;
                font-family: 'Audiowide', cursive;
                font-size: large;
            }

            button:active{
                transform: scale(0.95);
            }
            
        </style>
    </head>
    <body>
        <div class = "calculator">
            <div class = "display">0</div>
            <button class = "clear topButton">AC</button>
            <button class = "back topButton">CE</button>
            <button class = "topButton" id = "negate">+/-</button>
            <button class = "operator" value = division>/</button>
            <button class = "number" value = 7>7</button>
            <button class = "number" value = 8>8</button>
            <button class = "number" value = 9>9</button>
            <button class = "operator" value = multiplication>x</button>
            <button class = "number" value = 4>4</button>
            <button class = "number" value = 5>5</button>
            <button class = "number" value = 6>6</button>
            <button class = "operator" value = subtraction>-</button>
            <button class = "number" value = 1>1</button>
            <button class = "number" value = 2>2</button>
            <button class = "number" value = 3>3</button>
            <button class = "operator" value = addition>+</button>
            <button class = "number" id = "zero" value = 0>0</button>
            <button class = "number" id = "decimal" value = .>.</button>
            <button class = "operate">=</button>
        </div>

        <script>
            let display = document.querySelector(".display");

            let calculator = {
                addition: function add(a,b){
                    return (a*1) + (b*1);
                },
                subtraction: function subtract(a,b){
                    return a-b;
                },
                multiplication: function multiply(a,b){
                    return a*b;
                },
                division: function divide(a,b){
                     if (Number(b) === 0){
                         return display.textContent = "NOPE";
                    } else {
                         return a/b;
                    }
                },
            };

            function operate(operator, a, b){
                return operator(a,b);
            }
            
            let currentNum = "";
            let firstNum = "";
            let secondNum = "";
            let operator = "";
            let result = "";

            function storeNumber(){
                if (operator === ""){
                    firstNum = currentNum;
                }
                else{
                    secondNum = currentNum;
                }
            }

            let numbers = document.querySelectorAll(".number");
            numbers.forEach(button => button.addEventListener("click", (e)=>{
                    //remove leading zeros
                    if(currentNum.indexOf("0") === 0){
                        currentNum = currentNum.slice(1);
                    } 
                    if(currentNum.length<8){
                        currentNum += e.target.value;
                    }
                    display.textContent = currentNum;
                    storeNumber();
            }));

            let operators = document.querySelectorAll(".operator");
            operators.forEach(button => button.addEventListener("click", (e)=>{
                //if user presses another operator before =
                if(firstNum !== "" & secondNum !== ""){
                    result = operate(operator, firstNum, secondNum);
                    limitResult();
                    display.textContent = result;
                    firstNum = result;
                    secondNum = "";
                }
                //if user wants to operate on consecutive results
                else if(result !== "0" && result !== "NOPE" && firstNum === ""){
                    firstNum = result;
                    secondNum = "";
                }
                operator = calculator[e.target.value];
                currentNum = "";
            }));

            let calculate = document.querySelector(".operate");
            calculate.addEventListener("click", operateNow);
            function operateNow(){
                //if user presses = before entering operator
                if (operator === ""){
                    clearNow();
                }
                //if user presses = before entering second number
                if(secondNum === ""){
                    secondNum = firstNum;
                }
                result = operate(operator, firstNum, secondNum);
                limitResult();
                display.textContent = result;
                currentNum = "";
                firstNum = "";
                secondNum = "";
                operator = "";
            };

            function limitResult(){
                if(result.toString().length>8){
                    result = result.toPrecision(6);
                }
            }

            let back = document.querySelector(".back");
            back.addEventListener("click", backspace);
            function backspace(){
                if(currentNum === ""){
                    display.textContent = 0;
                }
                else{
                    currentNum = currentNum.slice(0, currentNum.length-1);
                    display.textContent = currentNum;
                    storeNumber();
                }
            };

            let negate = document.getElementById("negate");
            negate.addEventListener("click", negateNow);
            function negateNow(){
                if(currentNum === ""){
                    result = result * -1;
                    result = result.toString();
                    display.textContent = result;
                }
                else{
                    currentNum = currentNum * -1;
                    currentNum = currentNum.toString();
                    display.textContent = currentNum;
                    storeNumber();
                }
            };

            window.addEventListener("click", () =>{
                if(currentNum.indexOf(".") === -1){
                    document.getElementById("decimal").disabled = false;
                }
                else{
                    document.getElementById("decimal").disabled = true;
                }
            });

            let clear = document.querySelector(".clear");
            clear.addEventListener("click", clearNow);
            function clearNow(){
                currentNum = "";
                firstNum = "";
                secondNum = "";
                operator = "";
                result = "";
                display.textContent = 0;
            };
            

            //keyboard support below
            window.addEventListener("keypress", (e) => {
                if(e.charCode<58 && e.charCode>47){
                    //remove leading zeros
                    if(currentNum.indexOf("0") === 0){
                        currentNum = currentNum.slice(1);
                    }
                    if(currentNum.length<8){
                        currentNum += String.fromCharCode(e.charCode);
                    }
                    display.textContent = currentNum;
                    storeNumber();
                }
                //add decimal if there isn't one already
                else if(e.charCode === 46 && currentNum.indexOf(".") === -1){
                        currentNum += String.fromCharCode(e.charCode);
                        display.textContent = currentNum;
                        storeNumber();
                    }
                else if(e.charCode===47 || e.charCode===42 || e.charCode===45 || e.charCode===43){
                    //if user presses another operator before =
                    if(firstNum !== "" & secondNum !== ""){
                        result = operate(operator, firstNum, secondNum);
                        limitResult();
                        display.textContent = result;
                        firstNum = result;
                        secondNum = "";
                    }
                    //if user wants to operate on consecutive results
                    else if(result !== "0" && result !== "NOPE" && firstNum === ""){
                        firstNum = result;
                        secondNum = "";
                    }
                    let keyCalculator = {
                        43: "addition",
                        45: "subtraction",
                        42: "multiplication",
                        47: "division",
                    };
                    operator = calculator[keyCalculator[e.charCode]];
                    currentNum = "";
                }
            });

            window.addEventListener("keydown", (e) => {
                 //operates for equals sign or enter key
                if(e.charCode === 61 || e.keyCode === 13){
                    operateNow();
                }
                else if(e.keyCode === 46){
                    backspace();
                }
                else if(e.keyCode === 8){
                    clearNow();
                }
            });

            window.addEventListener("keypress", () =>{
                if(currentNum.indexOf(".") === -1){
                    document.getElementById("decimal").disabled = false;
                }
                else{
                    document.getElementById("decimal").disabled = true;
                }
            });

        </script>
    </body>
</html>